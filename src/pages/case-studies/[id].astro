---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import LenisInit from '../../components/LenisInit.astro';

export async function getStaticPaths() {
  const entries = await getCollection('caseStudies', ({ data }) => data.draft !== true);
  return entries.map((entry) => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
if (!entry) {
  Astro.response.status = 404;
}
const data = entry?.data;
const contactEmail = import.meta.env.RESEND_TO_EMAIL || '';
---

<Layout
  title={data ? `${data.title} — Julian Hardee` : 'Not Found — Julian Hardee'}
  description={data?.tagline ?? 'Case study not found'}
  image={data?.heroImage}
  imageAlt={data?.title ?? 'Case study'}
>
  <Header />
  <div class="relative mx-auto w-full flex-1 px-4 pt-8 pb-2 lg:px-[6.5rem]">
    <main class="flex w-full min-w-0 flex-1 flex-col">
      {entry && data ? (
      <>
      <div class="page-hero">
        <a href="/work" class="mb-8 inline-block text-sm font-medium text-muted-foreground underline-offset-4 hover:underline">
          ← Back to Work
        </a>
        <header class="mb-12">
          <h1 class="font-display text-4xl font-bold uppercase leading-[0.95] tracking-tight text-primary-black dark:text-white md:text-5xl">
            {data.title}
          </h1>
          <p class="mt-2 text-base md:text-xl leading-snug md:leading-normal text-primary-black/80 dark:text-white/80">
            {data.tagline}
          </p>
          <dl class="mt-6 grid gap-2 text-sm sm:grid-cols-2">
            <div>
              <dt class="font-semibold uppercase tracking-wider text-muted-foreground">Role</dt>
              <dd class="font-medium">{data.role}</dd>
            </div>
            <div>
              <dt class="font-semibold uppercase tracking-wider text-muted-foreground">Client</dt>
              <dd class="font-medium">{data.client}</dd>
            </div>
            <div>
              <dt class="font-semibold uppercase tracking-wider text-muted-foreground">Timeline</dt>
              <dd class="font-medium">{data.timeline}</dd>
            </div>
          </dl>
        </header>
      </div>

      <article>
      <div class="page-content">
        <img
          src={data.heroImage}
          alt={`${data.title} hero`}
          class="mb-12 w-full rounded-lg border border-border object-cover dark:border-border"
          width="1200"
          height="630"
        />

        <div class="space-y-12">
          <section>
            <h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Challenge</h2>
            <p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.challenge}</p>
          </section>
          <section>
            <h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Approach</h2>
            <p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.approach}</p>
          </section>
          <section>
            <h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Solution</h2>
            <p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.solution}</p>
          </section>
          <section>
            <h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Result</h2>
            <p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.result}</p>
          </section>
        </div>

        <footer class="mt-16 border-t border-border pt-8">
          <div class="flex flex-wrap gap-4">
            {data.projectLink && (
              <a
                href={data.projectLink}
                target="_blank"
                rel="noopener noreferrer"
                class="font-bold underline-offset-4 hover:underline"
              >
                View Project →
              </a>
            )}
            {data.github && (
              <a
                href={data.github}
                target="_blank"
                rel="noopener noreferrer"
                class="font-bold underline-offset-4 hover:underline"
              >
                GitHub →
              </a>
            )}
          </div>
          <div class="mt-6">
            <h3 class="mb-2 text-sm font-semibold uppercase tracking-wider text-muted-foreground">Tech Stack</h3>
            <p class="font-medium">{data.techStack.join(', ')}</p>
          </div>
          <div class="mt-4">
            <h3 class="mb-2 text-sm font-semibold uppercase tracking-wider text-muted-foreground">Services Provided</h3>
            <p class="font-medium">{data.servicesProvided.join(', ')}</p>
          </div>
        </footer>
      </div>
      </article>
      </>
      ) : (
      <div class="page-hero">
        <a href="/work" class="mb-8 inline-block text-sm font-medium text-muted-foreground underline-offset-4 hover:underline">
          ← Back to Work
        </a>
        <h1 class="font-display text-4xl font-bold uppercase leading-[0.95] tracking-tight text-primary-black dark:text-white md:text-5xl">
          WORKING ON IT!
        </h1>
        <p class="mt-4 max-w-xl text-base leading-relaxed text-primary-black/80 dark:text-white/80">
          This site is an ongoing work. Case studies are coming soon—but if in the meantime you'd like specific details, please reach out:
        </p>
        {contactEmail ? (
          <a href={`mailto:${contactEmail}`} class="mt-3 flex items-center gap-1 font-medium text-primary-black underline underline-offset-4 dark:text-white">
            <span>→</span>
            {contactEmail}
          </a>
        ) : (
          <span class="mt-3 flex items-center gap-1 font-medium">→ [email]</span>
        )}
      </div>
      )}
    </main>
  </div>
  <Footer />
  <LenisInit />
</Layout>
