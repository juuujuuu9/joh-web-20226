---
import '../../styles/global.css';
import favicon from '../../assets/favicon.svg';
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import LenisInit from '../../components/LenisInit.astro';

export async function getStaticPaths() {
  const entries = await getCollection('caseStudies', ({ data }) => data.draft !== true);
  return entries.map((entry) => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { data } = entry;
---

<html lang="en" class="font-sans">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href={favicon.src} />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="generator" content={Astro.generator} />
		<title>{data.title} — Thoughtform Worldwide</title>
		<script is:inline>
			const stored = localStorage.getItem('theme');
			const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (stored === 'dark' || (!stored && prefersDark)) document.documentElement.classList.add('dark');
			else document.documentElement.classList.remove('dark');
		</script>
	</head>
	<body class="flex min-h-dvh flex-col bg-light-bg pb-0 text-primary-black antialiased dark:bg-primary-black dark:text-white sm:pb-16">
		<Header />
		<div class="relative mx-auto w-full flex-1 px-6 pt-8 pb-2 lg:px-[6.5rem]">
			<main class="mx-auto max-w-4xl">
				<a href="/work" class="mb-8 inline-block text-sm font-medium text-muted-foreground underline-offset-4 hover:underline">
					← Back to Work
				</a>

				<article>
					<header class="mb-12">
						<h1 class="font-display text-4xl font-bold uppercase tracking-tight text-primary-black dark:text-white md:text-5xl">
							{data.title}
						</h1>
						<p class="mt-2 text-xl text-primary-black/80 dark:text-white/80">
							{data.tagline}
						</p>
						<dl class="mt-6 grid gap-2 text-sm sm:grid-cols-2">
							<div>
								<dt class="font-semibold uppercase tracking-wider text-muted-foreground">Role</dt>
								<dd class="font-medium">{data.role}</dd>
							</div>
							<div>
								<dt class="font-semibold uppercase tracking-wider text-muted-foreground">Client</dt>
								<dd class="font-medium">{data.client}</dd>
							</div>
							<div>
								<dt class="font-semibold uppercase tracking-wider text-muted-foreground">Timeline</dt>
								<dd class="font-medium">{data.timeline}</dd>
							</div>
						</dl>
					</header>

					<img
						src={data.heroImage}
						alt={`${data.title} hero`}
						class="mb-12 w-full rounded-lg border border-border object-cover dark:border-border"
						width="1200"
						height="630"
					/>

					<div class="space-y-12">
						<section>
							<h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Challenge</h2>
							<p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.challenge}</p>
						</section>
						<section>
							<h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Approach</h2>
							<p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.approach}</p>
						</section>
						<section>
							<h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Solution</h2>
							<p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.solution}</p>
						</section>
						<section>
							<h2 class="mb-4 text-2xl font-bold text-primary-black dark:text-white">The Result</h2>
							<p class="whitespace-pre-line text-primary-black/90 leading-relaxed dark:text-white/90">{data.result}</p>
						</section>
					</div>

					<footer class="mt-16 border-t border-border pt-8">
						<div class="flex flex-wrap gap-4">
							{data.projectLink && (
								<a
									href={data.projectLink}
									target="_blank"
									rel="noopener noreferrer"
									class="font-bold underline-offset-4 hover:underline"
								>
									View Project →
								</a>
							)}
							{data.github && (
								<a
									href={data.github}
									target="_blank"
									rel="noopener noreferrer"
									class="font-bold underline-offset-4 hover:underline"
								>
									GitHub →
								</a>
							)}
						</div>
						<div class="mt-6">
							<h3 class="mb-2 text-sm font-semibold uppercase tracking-wider text-muted-foreground">Tech Stack</h3>
							<p class="font-medium">{data.techStack.join(', ')}</p>
						</div>
						<div class="mt-4">
							<h3 class="mb-2 text-sm font-semibold uppercase tracking-wider text-muted-foreground">Services Provided</h3>
							<p class="font-medium">{data.servicesProvided.join(', ')}</p>
						</div>
					</footer>
				</article>
			</main>
		</div>
		<Footer />
		<LenisInit />
	</body>
</html>
